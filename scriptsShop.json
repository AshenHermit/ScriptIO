{
    "scripts": [
        "// template\n// simple script, does nothing.\nthis.disabled = false\n\nthis.init = function(player){\n    \n}\n\nthis.update = function(player){\n    \n}\n\nthis.draw = function(ctx, player){\n    \n}\n\nthis.destroy = function(player){\n    \n}",
        "// player_info\n// set players name and info position.\n\nthis.init = function(player){\n    player.infoY = 90\n    player.username = \"беспонтовый пирожок\"\n}",
        "// hp_bar\n// hp bar rendering.\nthis.disabled = false\n\nthis.init = function(player){\n    player.hp = 100\n}\n\nthis.update = function(player){\n    \n}\n\nthis.draw = function(ctx, player){\n    ctx.fillStyle = \"#404040\"\n    ctx.fillRect(player.position.x - 80/2-2, player.position.y - player.infoY-2, 80+4, 8)\n    var w = player.hp * (80/100)\n    ctx.fillStyle = \"#ff4040\"\n    ctx.fillRect(player.position.x - w/2, player.position.y - player.infoY, w, 4)\n}\n\nthis.destroy = function(player){\n    \n}",
        "// username_display\n// username rendering.\nthis.init = function(player){\n    \n}\n\nthis.draw = function(ctx, player){\n    ctx.font = \"14px Arial\"\n    ctx.textAlign = \"center\"\n    ctx.fillStyle = \"#555\"\n    ctx.fillText(player.username, \n        player.position.x, \n        player.position.y - player.infoY - 6)\n}\n",
        "// platformer\n// basic platformer behavior.\nthis.init = function(player){\n    player.overrideMovement = true\n    player.velocity.y = 0\n    \n    this.speed = 4\n}\n\nthis.update = function(player){\n    if(player.isLocal()){\n        if(player.isPressed[\"KeyW\"] && player.isOnFloor){\n            player.velocity.y = -10\n        }\n        if(player.isPressed[\"KeyA\"]){\n            player.velocity.x-=this.speed\n        }\n        if(player.isPressed[\"KeyD\"]){\n            player.velocity.x+=this.speed\n        }\n        \n        player.velocity.x/=2\n        player.velocity.y+=0.5\n        player.isOnFloor = physicsStep(player.position, player.velocity, 4)\n    }\n}\n\nthis.destroy = function(player){\n    player.overrideMovement = false\n}",
        "// player_collider\r\nthis.init = function(player){\r\n    this.collider = new Collider(\r\n        player.position.x, \r\n        player.position.y+4, \r\n        player.position.x, \r\n        player.position.y-16)\r\n    this.collider.physics = false\r\n    this.collider.onCollide = function(data){\r\n        if(player.isLocal()){\r\n            if(data && data.dmg){\r\n                player.hp = Math.max(player.hp-data.dmg, 0)\r\n            }\r\n        }\r\n    }\r\n    createCollider(this.collider)\r\n}\r\nthis.update = function(player){\r\n    this.collider.p1.x = player.position.x\r\n    this.collider.p1.y = player.position.y+4\r\n    this.collider.p2.x = player.position.x\r\n    this.collider.p2.y = player.position.y-32\r\n}\r\nthis.draw = function(ctx, player){\r\n    this.collider.draw(ctx)\r\n}\r\nthis.destroy = function(player){\r\n    destroyCollider(this.collider)\r\n}\r\n",
        "// letov\n// letov character.\n\nthis.attack = function(thisPlayer){\n    var dmg = 10\n    players.forEach((player)=>{\n        if(thisPlayer.uid!=player.uid){\n            let dist = player.position.sub(thisPlayer.position).magnitude()\n            if(dist<=80){\n                player.hp = Math.max(player.hp-dmg, 0)\n            }\n        }\n    })\n}\n\n\nthis.init = function(player){\n    this.texture = createImage(\n        \"https://s.tcdn.co/87f/059/87f05970-83c3-3983-917a-28c562062626/7.png\")\n    this.mirrored = false\n    this.step = 0\n    this.animSpeed = 0.2\n    player.overrideDraw = true\n}\n\nthis.update = function(player){\n    if(player.isLocal()){\n        if(player.isOnFloor)\n            this.step += Math.abs(player.velocity.x)*this.animSpeed/2\n    }else{\n        if(player.onPress[\"Space\"]){\n            this.attack(player)\n        }\n        this.step += Math.abs(player.velocity.x)*this.animSpeed/2\n    }\n    \n    if(player.isPressed[\"KeyD\"]){\n        this.mirrored = false\n    }else if(player.isPressed[\"KeyA\"]){\n        this.mirrored = true\n    }\n}\n\nthis.draw = function(ctx, player){\n    drawImagePlus(ctx, this.texture,\n    player.position.x, player.position.y+Math.sin(this.step)*2,\n    84,\n    Math.cos(this.step)/10,\n    0, -38,\n    this.mirrored, false)\n}\n\nthis.destroy = function(player){\n    player.overrideDraw = false\n}",
        "// shotgun\r\n// weapon.\r\n\r\nthis.texture = createImage(\r\n    \"https://pngimg.com/uploads/shotgun/shotgun_PNG34.png\")\r\n    \r\nvar shootSound = new Howl({\r\nsrc:[\"https://zvukipro.com/uploads/files/2018-10/1540717121_gun-spas-12-12-gauge-semi-automatic-shotgun-single-shot-close-perspective_f1otg9e_.mp3\"\r\n],\r\nvolume: 0.8,\r\n})\r\n\r\n\r\n\r\nvar angleToMouse = 0\r\nvar yOrigin = -20\r\nvar gunLength = 100\r\n\r\nfunction Bullet(player){\r\n    this.position = vector2()._set(player.position)._add(\r\n        vector2(Math.cos(angleToMouse)*(gunLength-42), Math.sin(angleToMouse)*(gunLength-42)))\r\n    this.position.y += yOrigin\r\n    this.opacity = 1\r\n    this.angle = ((player.random()-0.5)*Math.PI/10)+angleToMouse\r\n    this.direction = vector2(Math.cos(this.angle), Math.sin(this.angle))\r\n    ._mul(1000)\r\n    ._add(this.position)\r\n    \r\n    this.target = lineMapIntersect(this.position, this.direction)\r\n    if(this.target){\r\n        if(this.target.collider.onCollide){\r\n            this.target.collider.onCollide({dmg:5})\r\n        }\r\n    }\r\n    \r\n    this.update = function(player){\r\n        this.opacity = Math.max(this.opacity-0.02, 0)\r\n    }\r\n    \r\n    this.draw = function(ctx, player){\r\n        ctx.globalAlpha = Math.max(this.opacity*2-1.5, 0)\r\n        \r\n        if(this.target){\r\n            drawLine(ctx, \"#888\", 2, this.position.x, this.position.y,\r\n                this.target.x, this.target.y\r\n            )\r\n        }else{\r\n            drawLine(ctx, \"#888\", 2, this.position.x, this.position.y,\r\n                this.direction.x, this.direction.y\r\n            )\r\n        }\r\n        \r\n        if(this.target){\r\n            ctx.globalAlpha = this.opacity\r\n            drawWithTransform(ctx, ()=>{\r\n                ctx.fillStyle = \"#fff\"\r\n                ctx.fillRect(-8, -8, 16, 16)\r\n            }, this.target.x, this.target.y, this.opacity+0.1, this.opacity)\r\n        }\r\n        ctx.globalAlpha = 1 \r\n    }\r\n}\r\n\r\nthis.bullets = []\r\n\r\nthis.timer = 0\r\nthis.update = function(player){\r\n    angleToMouse = Math.atan2(\r\n        player.mousePos.y - player.position.y-yOrigin, \r\n        player.mousePos.x - player.position.x)\r\n    \r\n    if(player.onPress[\"MouseL\"]){\r\n        var count = 3\r\n        for(var i=0; i<count; i++){\r\n            this.bullets.push(new Bullet(player, angleToMouse))\r\n        }\r\n        player.velocity.x -= Math.cos(angleToMouse) * 4\r\n        player.velocity.y -= Math.sin(angleToMouse) * 4\r\n            \r\n        setTimeout(()=>{this.bullets.splice(0, count)}, 1000*2)\r\n        shootSound.play()\r\n        cameraShake(30)\r\n    }\r\n    \r\n    for(var i=0; i<this.bullets.length; i++){\r\n        this.bullets[i].update(player)\r\n    }\r\n}\r\n\r\nthis.draw = function(ctx, player){\r\n    for(var i=0; i<this.bullets.length; i++){\r\n        this.bullets[i].draw(ctx, player)\r\n    }\r\n    \r\n    drawImagePlus(ctx, this.texture, \r\n    player.position.x, player.position.y+yOrigin,\r\n    gunLength,\r\n    angleToMouse, \r\n    20, 5,\r\n    false, !(angleToMouse < Math.PI/2 && angleToMouse > -Math.PI/2))\r\n}",
        "// machine_gun\r\n// weapon.\r\n\r\nthis.texture = createImage(\r\n    \"https://pngimg.com/uploads/machine_gun/machine_gun_PNG15.png\")\r\nvar angleToMouse = 0\r\nvar yOrigin = -20\r\nvar gunLength = 120\r\n\r\nvar shootSound = new Howl({\r\nsrc:[\"https://www.fesliyanstudios.com/soundeffects/Gunshots-Singles/master-orig-outdoor-close/308-Bolt-Action-Rifle-Single-Close-Gunshot-A-www.fesliyanstudios.com.mp3\"\r\n],\r\n})\r\n\r\n\r\nfunction Bullet(player){\r\n    this.position = vector2()._set(player.position)._add(\r\n        vector2(Math.cos(angleToMouse)*(gunLength/1.7), Math.sin(angleToMouse)*(gunLength/1.7)))\r\n    this.position.y += yOrigin\r\n    this.opacity = 1\r\n    this.angle = ((player.random()-0.5)*Math.PI/34)+angleToMouse\r\n    this.direction = vector2(Math.cos(this.angle), Math.sin(this.angle))\r\n    ._mul(1000)\r\n    ._add(this.position)\r\n    \r\n    this.target = lineMapIntersect(this.position, this.direction)\r\n    if(this.target){\r\n        if(this.target.collider.onCollide){\r\n            this.target.collider.onCollide({dmg:2})\r\n        }\r\n    }\r\n    \r\n    this.update = function(player){\r\n        this.opacity = Math.max(this.opacity-0.02, 0)\r\n    }\r\n    \r\n    this.draw = function(ctx, player){\r\n        ctx.globalAlpha = Math.max(this.opacity*2-1.5, 0)\r\n        ctx.strokeStyle = \"#888\"\r\n        ctx.lineWidth = 2\r\n        ctx.beginPath();\r\n        ctx.moveTo(this.position.x, this.position.y);\r\n        if(this.target) ctx.lineTo(this.target.x, this.target.y);\r\n        else ctx.lineTo(this.direction.x, this.direction.y);\r\n        ctx.stroke();\r\n        \r\n        if(this.target){\r\n            ctx.globalAlpha = this.opacity\r\n            drawWithTransform(ctx, ()=>{\r\n                ctx.fillStyle = \"#fff\"\r\n                ctx.fillRect(-8, -8, 16, 16)\r\n            }, this.target.x, this.target.y, this.opacity+0.1, this.opacity)\r\n        }\r\n        ctx.globalAlpha = 1 \r\n    }\r\n}\r\n\r\nthis.bullets = []\r\n\r\nthis.timer = 0\r\nthis.update = function(player){\r\n    angleToMouse = Math.atan2(\r\n        player.mousePos.y - player.position.y-yOrigin, \r\n        player.mousePos.x - player.position.x)\r\n        \r\n    if(this.timer>0) this.timer-=1\r\n    \r\n    if(this.timer<=0 && player.isPressed[\"MouseL\"]){\r\n        var count = 1\r\n        for(var i=0; i<count; i++){\r\n            this.bullets.push(new Bullet(player, angleToMouse))\r\n        }\r\n        player.velocity.x -= Math.cos(angleToMouse) * 2\r\n        player.velocity.y -= Math.sin(angleToMouse) * 2\r\n            \r\n        setTimeout(()=>{this.bullets.splice(0, count)}, 1000*2)\r\n        cameraShake(15)\r\n        shootSound.play()\r\n        this.timer = 7\r\n    }\r\n    \r\n    for(var i=0; i<this.bullets.length; i++){\r\n        this.bullets[i].update(player)\r\n    }\r\n}\r\n\r\nthis.draw = function(ctx, player){\r\n    for(var i=0; i<this.bullets.length; i++){\r\n        this.bullets[i].draw(ctx, player)\r\n    }\r\n    \r\n    drawImagePlus(ctx, this.texture, \r\n    player.position.x, player.position.y+yOrigin,\r\n    gunLength,\r\n    angleToMouse, \r\n    -20, 5,\r\n    true, !(angleToMouse < Math.PI/2 && angleToMouse > -Math.PI/2))\r\n}",
        "// cat_bomb\n// allows to throw random ahegao image.\n\n\nthis.images = [\n\"https://shop.purina.ru/media/catalog/product/cache/19/thumbnail/600x/a4e40ebdc3e371adff845072e1c73f37/0/3/03010470169401_c1n1_friskies_cat_with_meat_chicken_and_wholesome_vegetables_400g_2_43898448.png\",\n\"https://cdn1.ozone.ru/s3/multimedia-i/6004912326.jpg\",\n\"https://cdn1.ozone.ru/multimedia/c500/1019309073.JPG\",\n\"https://pngimg.com/uploads/dog_food/dog_food_PNG4.png\",\n\"https://opt-1289021.ssl.1c-bitrix-cdn.ru/upload/iblock/a68/a683e6ecd07204eb74b702923be33342.png?159054197570107\",\n]\n\nthis.images = this.images.map((x)=>{\n    return createImage(x)\n})\n\nfunction Particle(player, images){\n    this.position = vector2()._set(player.position)\n    this.velocity = vector2(player.velocity.x*player.random()*4, -player.random()*8-4)\n    \n    this.rotation = (player.random()*2-1)/10\n    this.angle = 0\n    \n    this.image = images[Math.floor(player.random()*images.length)]\n    \n    this.update = function(player){\n        this.angle += this.rotation\n        this.position._add(this.velocity)\n        this.velocity.y+=0.4\n    }\n    \n    this.draw = function(ctx){\n        drawImage(ctx, this.image, this.position.x, this.position.y, 128, this.angle)\n    }\n}\n\nthis.particles = []\n\nthis.timer = 0\nthis.update = function(player){\n    //player.position._set(player.mousePos)\n    \n    if(player.onPress[\"Space\"]){\n        var count = 50\n        for(var i=0; i<count; i++)\n            this.particles.push(new Particle(player, this.images))\n            \n        setTimeout(()=>{this.particles.splice(0, count)}, 1000*2)\n    }\n    \n    for(var i=0; i<this.particles.length; i++){\n        this.particles[i].update(player)\n    }\n}\n\nthis.draw = function(ctx, player){\n    \n    for(var i=0; i<this.particles.length; i++){\n        this.particles[i].draw(ctx)\n    }\n}",
        "// worm_behavior\r\n// worm character.\r\n\r\nvar texture = createImage(\"http://pngimg.com/uploads/eye/eye_PNG35647.png\")\r\n\r\nthis.speed = 0\r\nthis.speedTarget = 0\r\nthis.targetSpeed = 8\r\n\r\nvar wagons = []\r\nfunction Wagon(player, id){\r\n    this.id = id\r\n    this.position = vector2()._set(player.position)\r\n    \r\n    this.draw = function(ctx, player){\r\n        let angle = 0\r\n        if(this.id == 0){\r\n            angle = Math.atan2(\r\n                player.position.y-this.position.y,\r\n                player.position.x-this.position.x)\r\n                \r\n            this.position.x = player.position.x-Math.cos(angle)*16\r\n            this.position.y = player.position.y-Math.sin(angle)*16\r\n        }else{\r\n            angle = Math.atan2(\r\n                wagons[this.id-1].position.y-this.position.y,\r\n                wagons[this.id-1].position.x-this.position.x)\r\n            \r\n            this.position.x = wagons[this.id-1].position.x-Math.cos(angle)*16\r\n            this.position.y = wagons[this.id-1].position.y-Math.sin(angle)*16\r\n        }\r\n        \r\n        drawImage(ctx, texture, \r\n            this.position.x, this.position.y,\r\n            32,\r\n            angle,)\r\n    }\r\n}\r\n\r\nvar angleToMouse\r\n\r\nthis.init = function(player){\r\n    player.overrideMovement = true\r\n    player.overrideDraw = true\r\n    \r\n    for(var i=0; i<10; i++){\r\n        wagons.push(new Wagon(player, i))\r\n    }\r\n}\r\n\r\nthis.timer = 0\r\nthis.update = function(player){\r\n    angleToMouse = Math.atan2(\r\n        player.mousePos.y-player.position.y, \r\n        player.mousePos.x-player.position.x)\r\n        \r\n    if(player.isLocal()){\r\n        if(player.isPressed[\"MouseL\"]){\r\n            this.speedTarget = this.targetSpeed\r\n            this.speed += (this.speedTarget-this.speed) / 5\r\n        }else{\r\n            this.speedTarget = 0\r\n            this.speed += (this.speedTarget-this.speed) / 10\r\n        }\r\n        player.velocity.x = Math.cos(angleToMouse)*this.speed\r\n        player.velocity.y = Math.sin(angleToMouse)*this.speed\r\n        physicsStep(player.position, player.velocity, 16)\r\n    }\r\n    \r\n    if(!player.isLocal()){\r\n        for(var i=0; i<players.length; i++){\r\n            if(players[i].uid!=player.uid){\r\n                var dist = players[i].position.sub(player.position).magnitude()\r\n                if(dist<=64){\r\n                    if(players[i].isLocal()){\r\n                        players[i].hp = Math.max(players[i].hp-0.5, 0)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nthis.draw = function(ctx, player){\r\n    drawImage(ctx, texture, \r\n    player.position.x, player.position.y,\r\n    32,\r\n    angleToMouse)\r\n    \r\n    for(var i=0; i<wagons.length; i++){\r\n        wagons[i].draw(ctx, player)\r\n    }\r\n}\r\n\r\nthis.destroy = function(player){\r\n    player.overrideMovement = false\r\n    player.overrideDraw = false\r\n}",
        "// turrets\r\n// stationary turrets.\r\n\r\nvar turretTex = createImage(\r\n    \"https://psv4.userapi.com/c856428/u576828276/docs/d12/edefab219c88/turret.png?extra=UxnPhfqS-5eSgWgeUe80SpCwWR8a_Od-1FPuP7kBLq2XLSg6bkIs3kvPnVNwUzqgMbIJluL1YGisp0QGAOl7lCKow9jdoQ18sPuO5_5UVd8ZqJ_neuMYHI7G4XzjtUgt00D4-ZfDzWjmoPz_JfuL-kPrmg\")\r\nvar legsTex = createImage(\r\n    \"https://psv4.userapi.com/c856428/u576828276/docs/d7/080bc9f97a1e/turret_legs.png?extra=l98DBiCJEjyhvsi7JRuy2SVkYZW8YMAnifThJUADAYmp7bEGVmrYvCY0HgfFTbYs1jDejeyy3uzg5tDK94u9UdCQ-QahLBImDUa1YKeKfTkB68IYIaMOnBKV-3vdbIy43Q3IoUUWYzzd08aUnyCdy7pv-A\")\r\n\r\nvar fireTimer = 0\r\nvar dmg = 3\r\n\r\nfunction Turret(player){\r\n    this.position = vector2()._set(player.mousePos)\r\n    this.velocity = vector2(0, -4)\r\n    this.automatic = true\r\n    this.isOnFloor = false\r\n    \r\n    this.headY = -45\r\n    \r\n    this.angle = 0\r\n    this.targetPlayerUid = -1\r\n    this.findTimer = 0\r\n    \r\n    this.p1 = vector2()\r\n    this.target = vector2()\r\n    this.bulletOpacity = 0\r\n    \r\n    this.update = function(player){\r\n        if(!this.isOnFloor) {\r\n            this.velocity.y+=1\r\n            this.isOnFloor = physicsStep(this.position, this.velocity, 4)\r\n            this.p1.x = this.position.x\r\n            this.p1.y = this.position.y+this.headY-8\r\n        }\r\n        \r\n        if(!this.automatic){\r\n            this.angle = Math.atan2(\r\n                player.mousePos.y-this.p1.y,\r\n                player.mousePos.x-this.p1.x)\r\n                \r\n            if(player.isPressed[\"MouseL\"]){\r\n                if(fireTimer<=0){\r\n                    var p2 = vector2(Math.cos(this.angle), Math.sin(this.angle))\r\n                    ._mul(1000)\r\n                    ._add(this.p1)\r\n                    this.target = lineMapIntersect(this.p1, p2)\r\n                    if(this.target){\r\n                        if(this.target.collider.onCollide)\r\n                            this.target.collider.onCollide({dmg:3})\r\n                    }else{\r\n                        this.target = p2\r\n                    }\r\n                    this.bulletOpacity = 1\r\n                }\r\n            }\r\n            \r\n        }else{\r\n            if(this.findTimer>0) this.findTimer-=1\r\n            if(this.findTimer<=0){\r\n                this.targetPlayerUid = -1\r\n                let maxDist = 800\r\n                for(var i=0; i<players.length; i++){\r\n                    if(players[i].uid!=player.uid){\r\n                        var dist = players[i].position.sub(this.position).magnitude()\r\n                        if(dist<maxDist){\r\n                            maxDist = dist\r\n                            this.targetPlayerUid = players[i].uid\r\n                        }\r\n                    }\r\n                }\r\n                this.findTimer = 20\r\n            }\r\n            if(this.targetPlayerUid!=-1){\r\n                this.angle = Math.atan2(\r\n                    playerByUid[this.targetPlayerUid].position.y\r\n                    -this.p1.y,\r\n                    playerByUid[this.targetPlayerUid].position.x-this.p1.x)\r\n                if(fireTimer<=0){\r\n                    this.target = lineMapIntersect(this.p1, \r\n                        playerByUid[this.targetPlayerUid].position,\r\n                        true)\r\n                    if(!this.target){\r\n                        this.bulletOpacity = 1\r\n                        if(playerByUid[this.targetPlayerUid].isLocal()){\r\n                            playerByUid[this.targetPlayerUid].hp = \r\n                            Math.max(playerByUid[this.targetPlayerUid].hp-3, 0)\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n    \r\n    this.draw = function(ctx){\r\n        if(!this.automatic){\r\n            ctx.globalAlpha = this.bulletOpacity\r\n            drawLine(ctx, \"#d44\", 2,\r\n                this.p1.x,\r\n                this.p1.y,\r\n                this.target.x,\r\n                this.target.y\r\n            )\r\n            ctx.globalAlpha = 1\r\n        }else\r\n        if(this.targetPlayerUid!=-1){\r\n            ctx.globalAlpha = this.bulletOpacity\r\n            drawLine(ctx, \"#d44\", 2,\r\n                this.p1.x,\r\n                this.p1.y,\r\n                playerByUid[this.targetPlayerUid].position.x,\r\n                playerByUid[this.targetPlayerUid].position.y\r\n            )\r\n            ctx.globalAlpha = 1\r\n        }\r\n        \r\n        this.bulletOpacity = Math.max(this.bulletOpacity-0.15, 0)\r\n        \r\n        drawImage(ctx, legsTex, \r\n        this.position.x, this.position.y-40/2,\r\n        64)\r\n        \r\n        drawImagePlus(ctx, turretTex, \r\n        this.position.x, this.position.y+this.headY,\r\n        64, this.angle,\r\n        8, -11,\r\n        false, !(this.angle < Math.PI/2 && this.angle > -Math.PI/2))\r\n    }\r\n}\r\n\r\nvar turrets = []\r\n\r\nthis.init = function(player){\r\n    \r\n}\r\n\r\nthis.update = function(player){\r\n    if(fireTimer>0) fireTimer-=1\r\n    \r\n    if(player.onPress[\"MouseL\"] && player.isPressed[\"Digit1\"]){\r\n        turrets.push(new Turret(player))\r\n    }\r\n    \r\n    for(var i=0; i<turrets.length; i++){\r\n        turrets[i].update(player)\r\n    }\r\n    \r\n    if(fireTimer<=0) fireTimer=7\r\n}\r\n\r\nthis.draw = function(ctx, player){\r\n    for(var i=0; i<turrets.length; i++){\r\n        turrets[i].draw(ctx)\r\n    }\r\n}\r\n\r\nthis.destroy = function(player){\r\n    \r\n}"
    ]
}